<%= simple_form_for activity do |f| %>
  <% @attractions.each do |attraction| %>
    <%= f.fields_for "activities[#{attraction['location_id']}]" do |activity_fields| %>
      <label>
        <%= activity_fields.check_box :selected %>
        <b><%= attraction['name'] %></b>
      </label>
      <p><%= link_to attraction['address_obj']['address_string'], "http://maps.google.com/?q=#{attraction['name']} #{attraction['address_obj']['address_string']}", target: "_blank" %></p>

      <%= activity_fields.hidden_field :name, value: attraction['name'] %>
      <%= activity_fields.hidden_field :address, value: attraction['address_obj']['address_string'] %>
      <%= activity_fields.hidden_field :marker, value: @marker %>
      <% pictures = JSON.parse(pictures_tripadvisor(attraction['location_id']))['data'] %>
      <% if pictures.present? %>
        <% pictures.first(2).each_with_index do |picture, index| %>
          <% if picture['images']['large'] %>
            <% picture_field_name = "picture_#{index + 1}".to_sym %>
            <%= activity_fields.hidden_field picture_field_name, value: picture['images']['large']['url'] %>
            <div class="activity-picture">
              <%= image_tag picture['images']['large']['url'], class: 'medium-picture' %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
  <%= f.button :submit, class: 'button', value: 'Submit' %>
<% end %>
